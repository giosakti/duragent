# Feature Ideas

> **Scope:** v1.0+ features. These are not part of the initial roadmap (v0.1–v0.8) but are documented here for future planning.

This document captures ideas for more capabilities that would enable more use cases like household automation, IoT integration, and multi-agent supervision.

## Use Cases These Enable

| Use Case | Required Capabilities |
|----------|----------------------|
| Household finance in group chat | Cron (daily summaries), group memory, async notifications |
| Remote control home appliances | Inbound webhooks (sensor events), companion nodes |
| Supervise agent making PRs | Sub-agent spawning, webhooks (GitHub events), async delivery |
| Always-on voice assistant | Companion nodes (iOS/Android), voice wake |

---

## 1. Cron/Scheduling

Trigger agent tasks on a schedule without external tools.

### Configuration

```yaml
# duragent.yaml
cron:
  enabled: true
  store: ./.duragent/cron/             # Persistent job state
  max_concurrent: 4

  jobs:
    - name: daily-expense-summary
      schedule: "0 20 * * *"        # 8pm daily
      timezone: "America/Los_Angeles"
      agent: finance-bot
      message: "Summarize today's expenses and categorize them"
      session: isolated             # isolated | main
      deliver:
        channel: telegram
        to: "-1001234567890"

    - name: weekly-review
      schedule: "0 10 * * FRI"      # Friday 10am
      agent: productivity-bot
      message: "Generate weekly review of completed tasks"
      deliver:
        channel: slack
        to: "#personal"

    - name: one-shot-reminder
      at: "2025-02-01T09:00:00Z"    # One-time trigger
      agent: reminder-bot
      message: "Remind user about dentist appointment"
```

### Schedule Types

| Type | Field | Example | Description |
|------|-------|---------|-------------|
| Cron | `schedule` | `"0 20 * * *"` | 5-field cron expression |
| One-shot | `at` | `"2025-02-01T09:00:00Z"` | ISO timestamp, runs once |
| Interval | `every` | `"30m"` | Fixed interval (future) |

### Session Modes

| Mode | Behavior |
|------|----------|
| `isolated` | Dedicated session per job run (`cron:<job_name>:<timestamp>`) |
| `main` | Enqueue into agent's main session |

### CLI

```bash
duragent cron list                      # List all jobs
duragent cron add --name "..." --schedule "..." --agent "..."
duragent cron remove <job_name>
duragent cron run <job_name>            # Trigger immediately
duragent cron logs <job_name>           # View run history
```

---

## 2. Inbound Webhooks

Receive events from external systems (GitHub, Home Assistant, email, etc.) and trigger agent sessions.

### Configuration

```yaml
# duragent.yaml
webhooks:
  enabled: true
  path_prefix: /hooks               # Endpoints at /hooks/*
  token: ${DURAGENT_WEBHOOK_TOKEN}      # Required for auth

  endpoints:
    - name: github
      path: /hooks/github
      agent: pr-supervisor
      transform: github-event       # Optional payload transformer
      session: isolated

    - name: home-assistant
      path: /hooks/home
      agent: home-bot
      session: main                 # Enqueue to main session

    - name: generic
      path: /hooks/trigger
      # No agent = uses routing table
```

### Webhook Request

```bash
curl -X POST http://localhost:8080/hooks/github \
  -H "Authorization: Bearer $DURAGENT_WEBHOOK_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "action": "opened",
    "pull_request": {
      "number": 123,
      "title": "Add authentication",
      "html_url": "https://github.com/owner/repo/pull/123"
    }
  }'
```

### Payload Transformers

Transform incoming payloads into agent-friendly messages:

```yaml
# .duragent/transforms/github-event.yaml
name: github-event
template: |
  GitHub event: {{ action }}
  {% if pull_request %}
  PR #{{ pull_request.number }}: {{ pull_request.title }}
  URL: {{ pull_request.html_url }}
  {% endif %}
```

### Response

```json
{
  "ok": true,
  "data": {
    "session_id": "webhook:github:1706123456",
    "queued": true
  }
}
```

---

## 3. Sub-agent Spawning

Allow agents to spawn isolated sub-agents for parallel work, delegation, or supervision.

### Built-in Tool

```yaml
# agent.yaml
tools:
  - name: spawn_agent
    type: builtin
    config:
      max_concurrent: 4             # Max parallel sub-agents
      timeout: 10m                  # Default timeout per sub-agent
      announce_back: true           # Notify when sub-agent completes
```

### Tool Interface

```rust
pub struct SpawnAgentParams {
    /// Task description for the sub-agent
    pub task: String,
    /// Agent to spawn (must exist)
    pub agent_id: String,
    /// Optional label for tracking
    pub label: Option<String>,
    /// Timeout (overrides default)
    pub timeout: Option<Duration>,
    /// Deliver result to channel when done
    pub deliver: Option<DeliveryTarget>,
}

pub struct SpawnResult {
    pub session_id: String,
    pub status: SpawnStatus,        // Running, Completed, Failed, Timeout
    pub result: Option<String>,     // Final response if completed
}
```

### Example Usage (Supervisor Agent)

```markdown
# Supervisor system prompt

When asked to review a PR:
1. Use `spawn_agent` to delegate the review:
   - agent_id: "code-reviewer"
   - task: "Review PR #123 at https://github.com/owner/repo/pull/123. Check for bugs, security issues, and style."
   - deliver: { channel: "slack", to: "#code-reviews" }
2. Continue with other work while sub-agent runs
3. Sub-agent will announce back when complete
```

### Session Isolation

Sub-agents run in isolated sessions:
- Session key: `subagent:<parent_session>:<uuid>`
- Separate memory context
- Cannot access parent session state
- Results returned via announce-back mechanism

---

## 4. Lifecycle Hooks

Execute shell scripts on agent/session lifecycle events for extensibility without code changes.

### Configuration

```yaml
# duragent.yaml
hooks:
  # Session lifecycle
  on_session_start:
    - ./hooks/load-user-context.sh
  on_session_end:
    - ./hooks/save-session-summary.sh

  # Agent lifecycle
  on_agent_load:
    - ./hooks/validate-agent.sh
  on_agent_error:
    - ./hooks/notify-owner.sh

  # Message lifecycle
  on_message_received:
    - ./hooks/log-message.sh
  on_tool_call:
    - ./hooks/audit-tool.sh
```

### Hook Script Interface

Scripts receive context via environment variables:

```bash
#!/bin/bash
# hooks/save-session-summary.sh

# Available env vars:
# DURAGENT_SESSION_ID, DURAGENT_AGENT_ID, DURAGENT_EVENT_TYPE
# DURAGENT_MESSAGE_COUNT, DURAGENT_LAST_MESSAGE, etc.

echo "Session $DURAGENT_SESSION_ID ended after $DURAGENT_MESSAGE_COUNT messages"

# Save summary to memory
curl -X POST "http://localhost:8080/api/v1/memory" \
  -d "{\"agent\": \"$DURAGENT_AGENT_ID\", \"content\": \"Session ended...\"}"
```

### Hook Locations (Precedence)

1. `<workspace>/hooks/` — Agent-specific hooks
2. `.duragent/hooks/` — Project-level hooks
3. `~/.duragent/hooks/` — User-level hooks

---

## 5. Vector Memory Search

Semantic search across agent memory using embeddings.

### Configuration

```yaml
# agent.yaml
memory:
  long_term:
    backend: filesystem
    path: ./.duragent/memory/

    search:
      enabled: true
      provider: ollama              # ollama | openai | anthropic
      model: nomic-embed-text       # Embedding model

      # Hybrid search (vector + full-text)
      hybrid:
        enabled: true
        vector_weight: 0.7
        text_weight: 0.3

      # Vector store
      store:
        backend: sqlite-vec         # sqlite-vec | pgvector
        path: ./.duragent/memory.db
```

### Built-in Tools

```yaml
tools:
  - name: memory_search
    type: builtin
    description: "Search long-term memory semantically"

  - name: memory_save
    type: builtin
    description: "Save important information to long-term memory"
```

### Memory File Format

```markdown
<!-- .duragent/memory/2025-01-24.md -->

## Expense: Groceries
- Amount: $50
- Category: Food
- Paid by: Wife
- Note: Weekly grocery run

## Preference Learned
- User prefers morning meetings before 10am
- User dislikes lengthy email threads
```

---

## 6. Companion Nodes

Native apps (iOS, Android, macOS) that connect to Duragent for device-level capabilities.

### Capabilities

| Node Type | Capabilities |
|-----------|--------------|
| iOS | Camera, screen recording, location, notifications, Shortcuts |
| Android | Camera, screen recording, location, notifications, SMS |
| macOS | System commands, clipboard, notifications, menu bar |
| Headless | Command execution on Linux/Windows servers |

### Discovery

Nodes discover Duragent gateway via:
1. mDNS (`_duragent-gw._tcp`)
2. Manual configuration (host + port)
3. Tailscale (if enabled)

### Pairing Flow

```bash
# On Duragent server
duragent nodes pending               # List pending pairing requests
duragent nodes approve <request_id>  # Approve device
duragent nodes list                  # List connected nodes
duragent nodes revoke <node_id>      # Revoke access
```

### Configuration

```yaml
# duragent.yaml
nodes:
  enabled: true
  discovery:
    mdns: true
    tailscale: true
  pairing:
    mode: approval               # approval | open | disabled
    token_expiry: 24h
```

### Node Commands (Future)

```yaml
# agent.yaml
tools:
  - name: node_camera
    type: builtin
    description: "Take photo using connected device camera"

  - name: node_notify
    type: builtin
    description: "Send push notification to connected device"

  - name: node_exec
    type: builtin
    description: "Execute command on connected node"
```

---

## 7. Browser Automation

Headless browser control for web automation tasks.

### Configuration

```yaml
# duragent.yaml
browser:
  enabled: true
  backend: playwright             # playwright | chrome-cdp
  headless: true
  profiles:
    default:
      user_data_dir: ./.duragent/browser/default
    work:
      user_data_dir: ./.duragent/browser/work
```

### Built-in Tools

```yaml
tools:
  - name: browser_open
    type: builtin
    description: "Open URL in browser"

  - name: browser_screenshot
    type: builtin
    description: "Take screenshot of current page"

  - name: browser_click
    type: builtin
    description: "Click element by selector or AI reference"

  - name: browser_type
    type: builtin
    description: "Type text into input field"

  - name: browser_snapshot
    type: builtin
    description: "Get page content as structured data"
```

---

## 8. Skills Ecosystem

Shareable, installable skill packages.

### Skill Package Format

```
skills/
└── github-pr-review/
    ├── SKILL.md                  # Instructions + triggers
    ├── metadata.yaml             # Dependencies, requirements
    └── tools/
        └── check-ci.sh           # Optional bundled tools
```

### Metadata

```yaml
# skills/github-pr-review/metadata.yaml
name: github-pr-review
version: 1.0.0
description: Review GitHub PRs with AI assistance
author: community

requires:
  bins: [gh]                      # Required CLI tools
  env: [GITHUB_TOKEN]             # Required env vars

triggers:
  - pattern: "review pr *"
  - webhook: github-pr-opened
```

### Registry (Future)

```bash
duragent skills search "github"
duragent skills install github-pr-review
duragent skills update --all
duragent skills list
```
