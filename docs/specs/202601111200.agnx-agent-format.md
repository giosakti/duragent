# Agnx Agent Format (AAF) Specification

## Overview

The Agnx Agent Format (AAF) defines a portable, human-readable specification for AI agents. It draws inspiration from:

- **[AGENTS.md](https://agents.md/)** — Simple markdown for coding agents (OpenAI/Linux Foundation)
- **[Claude Code Skills](https://code.claude.com/docs/en/skills)** — Skill.md with frontmatter and bundled resources
- **[Open Agent Specification](https://arxiv.org/abs/2510.04173v3)** — Declarative agent workflows (Oracle)
- **[A2A Protocol](https://a2a-protocol.org/)** — Agent Card for discovery (Google/Linux Foundation)
- **[Pi-mono/Clawdbot](https://docs.clawd.bot/concepts/agent)** — Bootstrap files pattern (AGENTS.md, SOUL.md, etc.)
- **Kubernetes manifests** — apiVersion/kind/metadata/spec pattern

## Design Principles

1. **Human-readable** — YAML/Markdown, editable in any text editor
2. **Portable** — Works across runtimes, not tied to Agnx
3. **Progressive** — Simple agents are simple; complex agents are possible
4. **Composable** — Skills, tools, and memory are modular
5. **Git-friendly** — Text files, easy to version and diff
6. **Context-efficient** — Minimal system prompts; load context on demand
7. **File-first storage** — Default to files for state; external backends for scale

## Deployment Context

AAF agents are designed to work in two deployment modes:

### Self-Hosted (File-Based State)

For power users running Agnx locally, agents and runtime states are stored as files under `./.agnx/`.

In this mode we assume **a single local user**; `./.agnx/{memory,sessions,artifacts}` are user-owned stores (not nested under a specific agent). Sessions and artifacts may reference which agent produced them.

```
~/agnx-workspace/
└── ./.agnx/                           # File-based state root (portable)
    ├── agents/
    │   └── my-agent/
    │       ├── agent.yaml              # Agent definition (AAF)
    │       ├── SYSTEM_PROMPT.md        # Agent system prompt
    │       ├── INSTRUCTIONS.md         # Agent behavior instructions
    │       └── skills/                 # Optional bundled skills
    │           └── task-extraction/
    │               └── SKILL.md
    ├── memory/                         # User memory store (may reference agent)
    │   ├── 2025-01-10.md
    │   └── 2025-01-11.md
    ├── sessions/                       # User sessions (reference agent + channel)
    │   └── session_abc.json
    └── artifacts/                      # User artifacts (reference producing run)
        └── generated.txt
```

**Benefits:**
- Everything is visible, editable, git-versioned
- No database setup required
- Agent + memory are portable as a single folder

**Note:** By convention, Agnx’s file-based state root is `./.agnx/` (relative to the current working directory). For simple self-hosted usage, you typically run Agnx from a workspace directory and keep all durable state under `./.agnx/`.

### SaaS (External State)

For managed services, the AAF agent definition is the same, but state is stored externally:

```yaml
services:
  session:   { backend: postgres, url: ${DATABASE_URL} }
  memory:    { backend: postgres, url: ${DATABASE_URL} }
  artifacts: { backend: s3, bucket: my-artifacts, region: us-east-1 }
```

**Benefits:**
- Multi-tenant scalability
- ACID guarantees
- Centralized backup/restore
- Same agent definition works in both modes

## Agent Definition

### Minimal Agent

```yaml
# agent.yaml
apiVersion: agnx/v1alpha1
kind: Agent
metadata:
  name: simple-assistant
spec:
  model:
    provider: openrouter
    name: anthropic/claude-sonnet-4
  system_prompt: ./SYSTEM_PROMPT.md
```

### Full Agent

```yaml
# agent.yaml
apiVersion: agnx/v1alpha1
kind: Agent
metadata:
  name: productivity-assistant
  description: Personal productivity assistant with task management
  version: 1.0.0
  labels:
    domain: productivity
    tier: premium

spec:
  model:
    provider: openrouter
    name: anthropic/claude-sonnet-4
    temperature: 0.7
    max_output_tokens: 4096

  # Loaded into every turn of the conversation.
  system_prompt: ./SYSTEM_PROMPT.md

  # Detailed behavioral rules/playbooks.
  instructions: ./INSTRUCTIONS.md

  # Optional: extra “bootstrap” files injected at session start.
  bootstrap:
    - path: ./SOUL.md

  memory:
    short_term:
      backend: buffer
      max_tokens: 8000
    long_term:
      backend: filesystem

  tools:
    - name: web_search
      type: mcp
      # MCP server command or path. Prefer a pinned, explicit binary or container for portability.
      # Examples:
      # - server: /usr/local/bin/web-search-mcp
      # - server: docker run --rm ghcr.io/example/web-search-mcp:1.2.3
      server: /usr/local/bin/web-search-mcp
    - name: calendar
      type: mcp
      server: ./tools/calendar-mcp
      config:
        calendar_id: primary
    - name: git-helper
      type: cli
      command: ./tools/git-helper/script.sh
      readme: ./tools/git-helper/README.md
    - name: calculator
      type: builtin

  # Skill discovery:
  # - By default, Agnx scans `./skills/` relative to agent.yaml.
  # - You can also add extra skills from other directories or URLs via `skills`.
  skills_dir: ./skills/
  skills:
    - path: ../shared-skills/meeting-notes/
    - url: https://example.com/productivity/weekly-review

  triggers:
    - pattern: "extract tasks from *"
      skill: task-extraction
    - pattern: "meeting notes for *"
      skill: meeting-notes
    - schedule: "0 20 * * FRI"
      skill: weekly-review
```

## Spec Fields Reference

### metadata

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `name` | string | Yes | Unique identifier (alphanumeric, hyphens) |
| `description` | string | No | Human-readable description |
| `version` | string | No | Semantic version |
| `labels` | map | No | Key-value labels for filtering (e.g. `domain: productivity`, `tier: premium`) |

### spec.model

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `provider` | string | Yes | LLM provider (openrouter, openai, anthropic, ollama) |
| `name` | string | Yes | Model name/identifier |
| `temperature` | float | No | Sampling temperature (0-2, default 0.7) |
| `max_input_tokens` | int | No | Optional hint for Agnx-side input truncation before calling the provider |
| `max_output_tokens` | int | No | Max response tokens (output/completion tokens) |
| `base_url` | string | No | Override model provider's base URL |

### spec.system_prompt

Path to a markdown file defining the agent's identity and role. Loaded into every turn of a session.

**Best practice:** Keep this minimal. Put detailed behavioral rules in `INSTRUCTIONS.md` and put large, situational context into skills/bootstrap files loaded only when needed.

### spec.instructions

Path to a markdown file defining detailed behavioral instructions (the agent's "playbook"): operating rules, policies, step-by-step workflows, output formats, and refusal boundaries.

Can reference:
- `${user.name}` — User's name (from context)
- `${user.timezone}` — User's timezone
- `${date}` — Current date
- `${time}` — Current time
- `${agnx.data_dir}` — Runtime data root (file-based mode uses `./.agnx/`)

### spec.bootstrap

List of markdown files injected into context on first turn of a session.

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `path` | string | Yes | Path to markdown file |
| `max_tokens` | int | No | Truncate if file exceeds limit |
| `required` | bool | No | Error if file missing (default false) |

**Common bootstrap files (these are all optional, but useful):**

| File | Purpose |
|------|---------|
| `IDENTITY.md` | Who the agent is: name, role, vibe |
| `SOUL.md` | How the agent communicates: style rules, boundaries, tone |
| `USER.md` | User profile: timezone, pronouns, work focus areas, preferences |
| `AGENTS.md` | Operating instructions, capabilities |
| `TOOLS.md` | Guidance on when/how to use tools |
| `memory/YYYY-MM-DD.md` | Daily continuity logs — decisions, preferences, durable facts |

Example IDENTITY.md:
```markdown
- Name: Atlas
- Role: Personal productivity copilot
- Personality: Calm, pragmatic, systems-minded
- Signature: Short bullets, minimal fluff
```

Example SOUL.md:
```markdown
Communication style rules:
- Be concise and concrete; prefer bullet points over paragraphs
- Ask one clarifying question when requirements are ambiguous
- Avoid hype and filler; explain tradeoffs plainly
- Match the user's tone; only use emojis if the user uses them first
```

**Why bootstrap files?**
- Keeps system prompt minimal
- Files can be edited without changing agent spec
- Progressive disclosure — only loaded when needed
- Visible and debuggable (not hidden in prompts)

### spec.memory

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `short_term.backend` | string | No | buffer (default) or external |
| `short_term.max_tokens` | int | No | Token limit for in-context short-term memory |
| `long_term.backend` | string | No | filesystem (default) or external |

**Filesystem convention (file-based mode):**
- Use date-based Markdown files under `${agnx.data_dir}/memory/` (e.g. `YYYY-MM-DD.md`) for durable continuity notes.
- This keeps memory transparent, editable, and easy to export.

### spec.tools

List of tool definitions. Supports three types:

**Tool Types:**

| Type | Description | Use Case |
|------|-------------|----------|
| `mcp` | MCP server connection | Standard ecosystem tools |
| `cli` | CLI tool with README | Token-efficient, simple tools |
| `builtin` | Built-in Agnx tools | Core operations (calculator, etc.) |

**MCP Tool Fields:**

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `name` | string | Yes | Tool identifier |
| `type` | string | Yes | `mcp` |
| `server` | string | Yes | MCP server command or path |
| `config` | map | No | Tool-specific configuration |

**Note on runtime dependencies:** Agnx itself aims to be a single binary (no Node/Python required). Some MCP servers are distributed as Node packages (often run via `npx`), but that is an optional tool choice rather than a requirement of Agnx core. Prefer pinned binaries/containers for portability.

**CLI Tool Fields:**

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `name` | string | Yes | Tool identifier |
| `type` | string | Yes | `cli` |
| `command` | string | Yes | CLI command or script path |
| `readme` | string | Yes | Path to README (agent reads on-demand) |

**Why CLI tools?**
- More token-efficient than MCP (no upfront schema dump)
- Agent reads README only when it needs the tool
- Simpler to create (just a script + README)
- Progressive disclosure pattern

**Built-in Tool Fields:**

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `name` | string | Yes | Tool identifier (e.g., `calculator`) |
| `type` | string | Yes | `builtin` |

### spec.skills_dir

Directory containing local skills for this agent.

- Default: `./skills/` (relative to the agent directory)
- If set, Agnx will scan that directory for skill packages (each containing `SKILL.md`).

If a skill ID is needed (e.g. for `triggers.skill`), Agnx should derive it from:
- `SKILL.md` frontmatter `name` if present, otherwise
- the skill directory name.

### spec.skills

Optional additional skills to load, beyond whatever is discovered in `skills_dir`.

Each entry can point to:
- a local directory (`path`), or
- a remote skill package (`url`).

| Field | Type | Description |
|-------|------|-------------|
| `path` | string | Local path to a skill directory |
| `url` | string | Remote skill URL |

### spec.triggers

Automatic skill activation:

| Field | Type | Description |
|-------|------|-------------|
| `pattern` | string | Glob pattern to match user input |
| `schedule` | string | Cron expression for scheduled runs |
| `skill` | string | Skill ID to activate (from `skills_dir` and/or `skills`) |

## Skills

Skills are reusable behaviors that can be bundled with agents or shared independently.

### Real-World Skill Examples

| Skill | Purpose | Trigger |
|-------|---------|---------|
| `quick-note` | Capture a short note into a local file or notes app | "note: ...", "save this: ..." |
| `task-inbox` | Turn a message into actionable tasks and save them | "add a task ...", "remind me to ..." |
| `knowledge-search` | Search a personal knowledge base / docs folder | "search my notes for ...", "find docs about ..." |
| `draft-writer` | Produce a first draft with a specific structure/voice | "draft a post about ...", "write a memo for ..." |
| `weekly-review` | Summarize the week and propose next actions | Scheduled Fridays |
| `log-analyzer` | Inspect logs and return likely causes + next steps | "analyze logs for ...", "why did this fail?" |

**Key pattern:** Skills teach the agent how to use tools without writing code. Just drop a markdown file with instructions, triggers, and examples.

### Skill Directory Structure

```
skills/
└── task-extraction/
    ├── SKILL.md              # Required: Skill definition
    ├── scripts/
    │   └── extract.py        # Optional: Executable scripts
    ├── references/
    │   └── examples.md       # Optional: Loaded into context
    └── assets/
        └── template.txt      # Optional: Templates
```

### SKILL.md Format

Full example: `../examples/skills/task-extraction`

## A2A Agent Card (Discovery)

AAF supports the [A2A Protocol](https://a2a-protocol.org/) Agent Card format for agent discovery. When an agent is deployed to Agnx, it automatically generates an A2A-compatible Agent Card.

### Auto-Generated Agent Card

Agnx generates an Agent Card from the AAF definition:

```
GET /agents/{name}/.well-known/agent.json
```

**Example generated Agent Card:**

```json
{
  "name": "productivity-assistant",
  "description": "Personal productivity assistant with task management",
  "url": "https://agnx.example.com/agents/productivity-assistant",
  "version": "1.0.0",
  "protocolVersion": "0.3",
  "capabilities": {
    "streaming": true,
    "pushNotifications": false
  },
  "defaultInputModes": ["text"],
  "defaultOutputModes": ["text"],
  "skills": [
    {
      "id": "task-extraction",
      "name": "Task Extraction",
      "description": "Extract tasks from natural conversation",
      "inputModes": ["text"],
      "outputModes": ["text", "data"]
    },
    {
      "id": "meeting-notes",
      "name": "Meeting Notes",
      "description": "Generate structured meeting notes",
      "inputModes": ["text"],
      "outputModes": ["text"]
    }
  ],
  "securitySchemes": [
    {
      "type": "apiKey",
      "in": "header",
      "name": "Authorization"
    }
  ]
}
```

### AAF to Agent Card Mapping

| AAF Field | Agent Card Field |
|-----------|------------------|
| `metadata.name` | `name` |
| `metadata.description` | `description` |
| `metadata.version` | `version` |
| `skills_dir` + `skills[]` + `SKILL.md` frontmatter | `skills[].id`, `skills[].name`, `skills[].description` |
| `spec.tools` | `capabilities` (inferred) |

### Custom Agent Card Fields

For advanced A2A scenarios, you can extend the agent card in the AAF:

```yaml
# agent.yaml
apiVersion: agnx/v1alpha1
kind: Agent
metadata:
  name: my-agent
  a2a:
    defaultInputModes: [text, file]
    defaultOutputModes: [text, data]
    securitySchemes:
      - type: oauth2
        flows:
          authorizationCode:
            authorizationUrl: https://auth.example.com/authorize
            tokenUrl: https://auth.example.com/token
spec: {}
```

Agnx will still **serve the Agent Card as JSON** at `/.well-known/agent.json` because that’s what A2A specifies.

### Use Cases for Agent Card

1. **Agent Discovery:** Orchestrators can query `/.well-known/agent.json` to find agent capabilities
2. **Multi-Agent Scenarios:** Agents can discover and delegate to other agents
3. **API Documentation:** Clients can understand what an agent can do before interacting
4. **Security Negotiation:** Clients discover required authentication methods

## Agent Package (Export Format)

For portability, agents can be exported as packages.

### Package Structure

```
my-agent.agnx/
├── agent.yaml                # Agent definition
├── SYSTEM_PROMPT.md          # Referenced by agent.yaml (recommended)
├── INSTRUCTIONS.md           # Referenced by agent.yaml (optional)
├── skills/                   # Bundled skills
│   └── task-extraction/
└── manifest.json             # Package metadata
```

### manifest.json

```json
{
  "format_version": "1.0",
  "exported_at": "2025-12-15T10:00:00Z",
  "agnx_version": "0.3.0",
  "agent": {
    "name": "productivity-assistant",
    "version": "1.0.0"
  },
  "includes": {
    "skills": true
  },
  "checksum": "sha256:abc123..."
}
```

### Export/Import Commands

```bash
# Export agent
agnx export --agent productivity-assistant --output ./export/

# Import agent
agnx import --file ./my-agent.agnx/
```

## Comparison with Other Formats

| Feature | AAF | AGENTS.md | Claude Skills | Open Agent Spec | A2A Agent Card |
|---------|-----|-----------|---------------|-----------------|----------------|
| Format | YAML + MD | Markdown | MD + frontmatter | YAML/JSON | JSON |
| Agent definition | Yes | No (instructions only) | No (skills only) | Yes | No (discovery only) |
| Skills/behaviors | Yes | No | Yes | Partial | Metadata only |
| Memory config | Yes | No | No | Partial | No |
| Tool integration | MCP | N/A | N/A | Custom | N/A |
| Discovery | A2A Card | No | No | No | Yes |
| Export/import | Yes | No | No | Partial | No |
| Human-readable | Yes | Yes | Yes | Yes | Yes |

### Relationship to Standards

- **AGENTS.md compatibility:** AAF's `instructions` field can reference AGENTS.md files
- **Claude Skills compatibility:** AAF skills follow similar structure to Claude Skills
- **Open Agent Spec compatibility:** AAF can be converted to/from OAS format
- **A2A compatibility:** AAF auto-generates A2A Agent Cards for discovery
- **MCP compatibility:** Tools use MCP protocol natively

## Examples

### Example 1: Simple Q&A Bot

```yaml
apiVersion: agnx/v1alpha1
kind: Agent
metadata:
  name: qa-bot
spec:
  model:
    provider: openrouter
    name: anthropic/claude-sonnet-4
  system_prompt: ./SYSTEM_PROMPT.md
```

### Example 2: Code Review Agent

```yaml
apiVersion: agnx/v1alpha1
kind: Agent
metadata:
  name: code-reviewer
spec:
  model:
    provider: openrouter
    name: anthropic/claude-sonnet-4
    temperature: 0.3
  system_prompt: ./SYSTEM_PROMPT.md
  instructions: ./INSTRUCTIONS.md
  tools:
    - name: github
      type: mcp
      server: /usr/local/bin/github-mcp
  skills:
    - path: ./skills/security-review/
    - path: ./skills/performance-review/
```

### Example 3: Personal Assistant

```yaml
apiVersion: agnx/v1alpha1
kind: Agent
metadata:
  name: personal-assistant
spec:
  model:
    provider: openrouter
    name: anthropic/claude-sonnet-4
  system_prompt: ./SYSTEM_PROMPT.md
  instructions: ./INSTRUCTIONS.md
  memory:
    short_term:
      backend: buffer
      max_tokens: 8000
    long_term:
      backend: filesystem
  tools:
    - name: asana
      type: mcp
      server: ./tools/asana-mcp
  skills:
    - path: ./skills/task-extraction/
    - path: ./skills/daily-review/
    - path: ./skills/knowledge-query/
  triggers:
    - schedule: "0 20 * * *"
      skill: daily-review
```

## Versioning

The format uses semantic versioning-like API versions:
- `agnx/v1alpha1` — Alpha version (breaking changes allowed)
- `agnx/v1beta1` — Beta version (mostly stable; minor breakage still possible)
- `agnx/v1` — Stable version
- `agnx/v2` — Future breaking changes

Agnx runtime will support multiple versions and provide migration tools.

## References

### Standards
- [AGENTS.md Specification](https://agents.md/)
- [A2A Protocol Specification](https://a2a-protocol.org/) — Agent-to-Agent protocol (Linux Foundation)
- [Open Agent Specification](https://arxiv.org/abs/2510.04173v3)
- [Model Context Protocol](https://modelcontextprotocol.io/)
- [Agent Protocol](https://agentprotocol.ai/)

### Format Inspiration
- [Claude Code Skills](https://code.claude.com/docs/en/skills) — Skill.md format
- [Google ADK](https://google.github.io/adk-docs/) — Agent Development Kit
- [Pi-mono](https://github.com/badlogic/pi-mono) — Minimal agent toolkit
